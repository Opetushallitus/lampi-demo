include:
  - ../docker-compose.yml

services:
  test:
    build:
      context: ..
      dockerfile: ./test/Dockerfile
    depends_on:
      db-task:
        condition: service_completed_successfully
    environment:
      ENV: "local-docker"
      PG_HOST: "db"
      PG_PORT: "5432"
      DB_NAME: "lampi"
      POSTGRES_USER: "pgadmin"
      POSTGRES_PASSWORD: "pgpassword"
      S3_ENDPOINT: "not used in tests"
    volumes:
      - ${TEST_RESULTS_DIR:-./test-results}:/app/test-results
